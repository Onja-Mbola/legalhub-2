{% extends "base.html" %}

{% block title %}Retour d'Audience - Dossier #{{ dossier_id }}{% endblock %}

{% block sidebar %}
{% include "partials/sidebar.html" %}
{% endblock %}

{% block topbar %}
{% include "partials/topbar.html" %}
{% endblock %}

{% block content %}
<div class="container mt-5">
    {% if error_msg %}
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        <strong>Erreur :</strong> {{ error_msg }}
        <button type="button" class="close" data-dismiss="alert" aria-label="Fermer">
            <span aria-hidden="true">Ã—</span>
        </button>
    </div>
    {% endif %}

    <div class="card shadow-lg rounded-4 border-0">
        <div class="card-header bg-gradient-primary text-white py-3">
            <h4 class="mb-0"><i class="fas fa-gavel me-2"></i> Retour d'Audience du dossier #{{ dossier_id }}</h4>
        </div>
        <div class="card-body">
            <form method="post" enctype="multipart/form-data" action="">
                <div class="mb-3">
                    <label for="date_audience" class="form-label fw-semibold">Date de l'audience <span class="text-danger">*</span></label>
                    <input type="datetime-local"
                           class="form-control"
                           id="date_audience"
                           name="date_audience"
                           required
                           value="{% if retour_audience and retour_audience.date_audience %}{{ retour_audience.date_audience.strftime('%Y-%m-%dT%H:%M') }}{% endif %}">
                </div>

                <div class="mb-3">
                    <label for="nom_judge" class="form-label fw-semibold">Nom du juge</label>
                    <input type="text" class="form-control" id="nom_judge" name="nom_judge"
                           value="{{ retour_audience.nom_judge if retour_audience else '' }}">
                </div>

                <div class="mb-3">
                    <label for="observations_judge" class="form-label fw-semibold">Observations du juge</label>
                    <textarea class="form-control" id="observations_judge" name="observations_judge" rows="3">{{ retour_audience.observations_judge if retour_audience else '' }}</textarea>
                </div>

                <div class="mb-3">
                    <label for="observations_internes" class="form-label fw-semibold">Observations internes</label>
                    <textarea class="form-control" id="observations_internes" name="observations_internes" rows="3">{{ retour_audience.observations_internes if retour_audience else '' }}</textarea>
                </div>

                <div class="mb-3">
                    <label for="pv_audience" class="form-label fw-semibold">PV de l'audience (PDF ou image)</label>
                    {% if retour_audience and retour_audience.pv_audience %}
                    <p>Fichier actuel :
                        <a href="{{ url_for('documents', filepath=retour_audience.pv_audience.split('app/documents/')[-1]) }}"
                           target="_blank">
                            {{ retour_audience.pv_audience.split('/')[-1] }}
                        </a>
                    </p>
                    {% endif %}
                    <input type="file" class="form-control" id="pv_audience" name="pv_audience" accept=".pdf,.jpg,.jpeg,.png">
                </div>

                <button type="submit" class="btn btn-primary rounded-pill px-4">
                    <i class="fas fa-save me-2"></i> Enregistrer
                </button>
            </form>
        </div>
    </div>
</div>
{% endblock %}
